{{ header }}{{ column_left }}
<div id="content">
<link href="view/stylesheet/pw4_bootstrap_3.css" rel="stylesheet" type="text/css"/>
<link href="view/stylesheet/pw4_style.css" rel="stylesheet" type="text/css"/>
<link href="view/stylesheet/codevoc_b2b_mananger.css" rel="stylesheet">
<link href="view/stylesheet/codevoc_b2b_mananger_dark.css" rel="stylesheet">
<style type="text/css">
.btn {padding: 5px 11px;font-size: 11px;}
</style>
  <div class="page-header">
    <div class="container-fluid">
      <h1>Inköp</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>

<div class="container-fluid">
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><i class="fa fa-list"></i> List</h3>
  </div>
  <div class="panel-body">

  <div class="table-responsive">

  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <td width="3%"># Id</td>
        <td width="20%">Namn</td>
        <td width="5%">Inköpt av</td>
        <td width="15%">Datum</td>
        <td width="5%">Antal order</td>
        <td width="10%">Leverantör</td>
        <td width="10%">Inköp till</td>
        <td width="20%">Åtgärd</td>
      </tr>
    </thead>
    <tbody>
    {% if purchases %}
    {% for purchase in purchases %}
      <tr>
        <td align="center">{{ purchase.purchase_id }}</td>
        <td>
          <span class="pruchase-wordbreak">{{ purchase.name }}</span>
          {% if purchase.purchase_complete %}
          <i class="fa fa-check-circle" style="color:#33ac3f"></i>
          {% endif %}
        </td>
        <td>{{ purchase.purchased_by_name }}</td>
        <td><span style="border:1px solid #444c56;padding:2px 6px;margin-right:4px"><b>{{ date(purchase.date ) | date('l') }}</b> v.{{ date(purchase.date ) | date('W') }}</span> {{ purchase.date }}</td>
        <td align="center">{{ purchase.total_orders }}</td>
        <td><span class="pruchase-wordbreak">{{ purchase.suppliers }}</span></td>
        <td>{{ purchase.purchase_receiver_name }}</td>
        <td class="text-right">
          <a href="{{ purchase.edit }}" class="btn btn-primary"><i class="fa fa-pencil"></i></a>
          <a href="{{ purchase.print_purchase_list }}" class="btn btn-warning" target="_blank"><i class="fa fa-print"></i> Inköpslista</a>
          <form method="POST" action="{{ btn_print_purchased_order_list }}" style="display:inline">
            {% for order in purchase.orders %}
            <input type="hidden" name="selected[]" value="{{ order.order_id }}">
            {% endfor %}
            <button type="submit" class="btn btn-success" formtarget="_blank">
              <i class="fa fa-print"></i> Följesedel</a>
            </button>
          </form>
          <button type="button" data-toggle="tooltip" title="Remove Purhcase" class="btn btn-danger btn-remove-purchase" data-purchase-id="{{ purchase.purchase_id }}"><i class="fa fa-trash"></i></button>
        </td>
      </tr>
      {% endfor %}
      {% else %}
      <tr>
        <td class="text-center" colspan="8">{{ text_no_results }}</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  </div>

    <div class="row">
      <div class="col-sm-6 text-left">{{ pagination }}</div>
      <div class="col-sm-6 text-right">{{ results }}</div>
    </div>

  </div><!-- panel-body -->
</div><!-- panel panel-default -->

<script>
jQuery(document).ready(function($) {
  $(".btn-remove-purchase").on("click", function() {
    if(!confirm("Are you sure to delete?"))
      return;
    var currentButton = this
    var purchase_id = $(this).data('purchase-id')
    $.ajax({
			url: '{{ catalog }}index.php?route=codevoc/b2bmanager_purchase.deletePurchase&user_token={{ token }}',
			dataType: 'json',
      method: 'POST',
      data: {
        purchase_id: purchase_id,
      },
			beforeSend: function() {
        $(currentButton).button('loading');
			},
			complete: function() {
				$(currentButton).button("reset");
			},
			success: function(json) {
				if (json['error']) {
					alert(json['error'])
				}

				if (json['success']) {
          window.location.reload()
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
  })
})
</script>
{{ footer }}
