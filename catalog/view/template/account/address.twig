{{ header }}

<main class="main-body address-book-container">
  <div class="address-breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      
      {% if loop.last %}
      <span class="item">{{ breadcrumb.text }}</span>
      {% else %}
      <a href="{{ breadcrumb.href }}"><span class="item active">{{ breadcrumb.text }}</span></a>
      <span class="round"></span>
      {% endif %}

    {% endfor %}
  </div>
  <div class="center-container">
    {{ column_left }}
    <div class="right">
      {% if success %}
        <div class="alert alert-success alert-dismissible"><i class="fa-solid fa-circle-check"></i> {{ success }}</div>
      {% endif %}
      {% if error %}
        <div class="alert alert-danger alert-dismissible"><i class="fa-solid fa-circle-check"></i> {{ success }}</div>
      {% endif %}
      <div class="address-header">
        <h4>{{ text_address_book }}</h4>
        <button class="primaryButton add-new-address-btn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRightaddNewAddress" aria-controls="offcanvasRightaddNewAddress">
          {{ button_new_address }}
          <img src="image/arrow_right_white.svg" alt="Arrow">
        </button>
        {{ address_form }}
      </div>
      <div class="address-card-container">
          {{ list }}
      </div>
    </div>
  </div>

<script type="text/javascript"><!--
$('#address').on('click', '.btn-danger', function (e) {
    e.preventDefault();

    var element = this;

    $.ajax({
        url: $(element).attr('href'),
        dataType: 'json',
        beforeSend: function () {
            $(element).prop('disabled', true);
        },
        complete: function () {
            $(element).prop('disabled', false);
        },
        success: function (json) {
            console.log(json);

            $('.alert-dismissible').remove();

            if (json['error']) {
                $('#address').before('<div class="alert alert-danger alert-dismissible"><i class="fa-solid fa-circle-exclamation"></i> ' + json['error'] + ' <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
            }

            if (json['success']) {
                $('#address').before('<div class="alert alert-success alert-dismissible"><i class="fa-solid fa-circle-check"></i> ' + json['success'] + ' <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');

                $('#address').load('index.php?route=account/address.list&language={{ language }}&customer_token={{ customer_token }}');
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});
//--></script>
<script type="text/javascript"><!--
$('#input-country').on('change', function () {
    var element = this;

    $.ajax({
        url: 'index.php?route=localisation/country&country_id=' + this.value + '&language={{ language }}',
        dataType: 'json',
        beforeSend: function () {
            $(element).prop('disabled', true);
            $('#input-zone').prop('disabled', true);
        },
        complete: function () {
            $(element).prop('disabled', false);
            $('#input-zone').prop('disabled', false);
        },
        success: function (json) {
            if (json['postcode_required'] == '1') {
                $('#input-postcode').parent().parent().addClass('required');
            } else {
                $('#input-postcode').parent().parent().removeClass('required');
            }

            html = '<option value="">{{ text_select }}</option>';

            if (json['zone'] && json['zone'] != '') {
                for (i = 0; i < json['zone'].length; i++) {
                    html += '<option value="' + json['zone'][i]['zone_id'] + '"';

                    if (json['zone'][i]['zone_id'] == '{{ zone_id }}') {
                        html += ' selected';
                    }

                    html += '>' + json['zone'][i]['name'] + '</option>';
                }
            } else {
                html += '<option value="0" selected>   {{ text_none }}</option>';
            }

            $('#input-zone').html(html);
        },
        error: function (xhr, ajaxOptions, thrownError) {
            console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

$('#input-country').trigger('change');
//--></script>
{{ footer }}
